\def\chapternumber{ldap -- 3 May 2012}
\input slides.tex
\centerline{\bbf LDAP}
\centerline{Lightweight Directory Access Protocol}

\vf

User names and passwords are kept on a Windows Server.

The Windows Server is set to provide LDAP.

\vf

A Unix box may be configured to use the LDAP protocol to access the
user names and passwords.

This causes and  account on the Windows Server to also
become an account on the Unix box.

\vt

Useful in adding a Unix machine to a Windows based environment.

\newslide

\centerline{\bbf The Components}

Utility procedures (system calls).
\break
Used by LDAP client programs.
\break
Used by programs that the "name switch",
\break
({\ltt{}nsswitch.conf})
\break
like password and group (login).

LDAP client libraries.
\break
Where the utility procedures are implemented.

LDAP client programs.
\break
These are mostly useful for testing to see if your install is working.

LDAP client daemons.
\break
These maintain connections with the ldap server.

LDAP server daemons.
\break
You only need these if you are providing ldap to other machines.

Your install details vary with the Linux release you use. 

Your windows server (active directory) must provide ldap.
\newslide
\centerline{\bbf Ubuntu Install}

Load the following libraries:


{\ltt{}libpam-ldap}: {\ltt{}/lib/security/pam_ldap.so}
\break
{\ltt{}libpam-smbpass}: {\ltt{}/lib/security/pam_smbpass.so}
\break
{\ltt{}winbind}: {\ltt{}/lib/security/pam_winbind.so}

If you use the Ubuntu package install utility you will be asked for
the {\bit uri} and {\bit base}
\break
if not, you edit them into the config files.

The package install utility will start {\ltt{}winbind},
\break
otherwise start it by hand.

\newslide
\centerline{\bbf Configuration Files}
\centerline{{\ltt{}ldap.conf}}

Because many facilities (ldap server, ldap client
browsers) use this file it has much in it that
is ignored. It also needs to be able to compensate for the
way your Windows domain controllers are set up. 
You may also find more than one of these files with
different parts ``missing".

\vt

{\ltt{}base cn=users,dc=ad,dc=example,dc=com}

The PDC does active directory in a subdomain called {\ltt{}ad}.
\break
We are interested in {\ltt{}users}, that is logins.

\vt

{\ltt{}uri ldap://192.168.1.1  ldap://192.168.1.2}
\break
{\ltt{}host 192.168.1.1  192.168.1.2}
\break
{\ltt{}#port 389}

Some facilities use the uri format;
\break
some use the host:port format.
\break
Recommendation: use numbers and not names.
\break
The port defaults to 389.
\break
You may specify the port as part of the uri or host name
\break
(use {\ltt{}:398} following the internet number)

\newslide
\centerline{{\ltt{}ldap.conf}}

{\ltt{}ldap_version 3}

Options are 2 or 3, 2 is legacy.

\vt

{\ltt{}binddn padl@ad.example.com}
\break
{\ltt{}bindpw somepassword}

Entries shown assume you are using the PADL version of ldap on your
windows machine.
\break
It logs into the PDC with the account name and password shown.
\break
If the {\ltt{}binddn} is omitted it logs in anonymously and ignores
the {\ltt{}bindpw}.

\vt

{\ltt{}#scope sub}

Do subtree lookups (for the logins).
\break
(Under the ``{\ltt{}users}" subtree.)

\newslide
\centerline{{\ltt{}ldap.conf}}

\vt

{\program
pam_login_attribute msSFU30Name
pam_password md5
nss_base_passwd cn=users,dc=ad,dc=example,dc=com?one
nss_base_group cn=users,dc=ad,dc=example,dc=com?one
nss_map_objectclass posixAccount User
nss_map_attribute uid msSFU30Name
nss_map_attribute uidNumber msSFU30UidNumber
nss_map_attribute gidNumber msSFU30GidNumber
nss_map_attribute loginShell msSFU30LoginShell
nss_map_attribute gecos name
nss_map_attribute userPassword msSFU30Password
nss_map_attribute homeDirectory msSFU30HomeDirectory
nss_map_attribute posixGroup Group
nss_map_attribute uniqueMember posixMember
nss_map_attribute cn sAMAccountName
\endprogram}

Maps Windows/LDAP fields to Linux fields.
\break
All these have defaults ({\ltt{}RFC 2307}, 1998)
\break
so they may not be necessary for your configuration.

\newslide
\centerline{{\ltt{}ldap.conf}}

\vt

{\ltt{}nss_initgroups_ignoreusers bin,daemon,lp, mail,syslog}

These users should never log in,
\break
don't bother to check the PDC, just deliver a failed.
\break
Note: important if you check {\ltt{}ldap} before {\ltt{}files}

\vt

{\ltt{}#ssl no}

You may use ssl to connect to the server, the default is not to.
\break
Not all client libraries support ssl.

\newslide
\centerline{\bbf Configuration Files}
\centerline{{\ltt{}/etc/nsswitch.conf}}

For the {\ltt{}passwd}, {\ltt{}group}
and {\ltt{}shadow} entries:
\break
add {\ltt{}ldap}

Example:

{\ltt{}passwd files ldap}

\vf

\centerline{\bbf Home Directories}

You are logging into the Unix machine,
\break
not the Windows Domain.

You must create the home directories on the Unix machine
\break
(they can be on an NFS mount)
\newslide

\centerline{\bbf Testing}

\vt

{\ltt{}ldapsearch -x -b "cn=users,dc=ad,dc=example,dc=com" "uid=bob"}
\break
You should see information for the user bob.

\vt
{\ltt{}echo ~bob}
\break
You should get {\ltt{}/home/bob} or whatever bob's home directory
is set to.

\vt
{\ltt{}login bob}
\break
bob should be able to login
\bye

