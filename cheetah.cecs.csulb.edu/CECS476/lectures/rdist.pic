\def\chapternumber{rdist -- 22 April 2010}
\input slides.tex
\centerline{\bbf Managing Many Machines}
\centerline{rdist}

Situation: Many identical machines.
\break
Need to update/install file on each.

Solution 1: Log into each machine and install (pull).

Solution 2: Distribute the file from a central server (push).

{\ltt{}rdist}: remote file distribution program

From a designated management machine: 
\break
distribute files to a list of machines
\break
run install programs on those machines

{\ltt{}rdist [-f distfile] [-m host] [name ...]}

Run this program on the management machine

defaults to a file called {\ltt{}distfile} in the local
directory of the management machine.

usually: {\ltt{}rdist -f mydistfile}

Action: update all files and directories listed in distfile
\break
Administrator: plan your update, place command in mydistfile
run with mydistfile.

\newslide
\centerline{Simple distfile format (jaguar):}

{\program
newfstab -> root@lab30.net.cecs.csulb.edu
  install /etc/fstab ;
\endprogram}

Using the root account on lab30;
\break
copy a new fstab file to lab30.
\break
locally it is {\ltt{}newfstab} in {\ltt{}.}
\break
on lab30 call it {\ltt{}/etc/fstab}
\vt
Multi-machine format distfile:

{\program
newgroups -> (
  root@lab30.net.cecs.csulb.edu
  root@lab31.net.cecs.csulb.edu
  root@lab32.net.cecs.csulb.edu )
  install /etc/group ;
\endprogram}

or  a variable can be used

{\program
HOSTS = (
  root@lab30.net.cecs.csulb.edu
  root@lab31.net.cecs.csulb.edu
  root@lab32.net.cecs.csulb.edu )
newgroups -> ${HOSTS}
  install /etc/group ;
\endprogram}

\newslide
Multiple files can be moved, notification can be mailed.

{\program
wwwconf -> www@lab30.net.cecs.csulb.edu
  install /etc/www/www.conf ;
  notify sue@lab17.net.cecs.csulb.edu ;
newsuelogin -> sue@lab31.net.cecs.csulb.edu
  install /home/sue/.login ;
\endprogram}

using the www account on lab30,
\break
install the wwwconf (on lab30),
\break
notify sue on lab17 by mail of what happened

using the sue account on lab31
\break
install a new .login (sue on lab31)

\vt
Directory installs

{\program
FILES = ( /usr/src/yp /usr/X11 )
HOSTS = ( root@lab30 root@lab31 )
${FILES} -> ${HOSTS}
  install -R ;
\endprogram}

Recursively install the new directories,
\break
use the old names
\break
install with no name defaults to using the old directory/file names.

\newslide
Commands may be run (as part of the install)

{\program
master.passwd -> root@unix70.cecs.csulb.edu
  install /etc/master.passwd ;
  special "pwd_mkdb /etc/master.passwd" ;
\endprogram}

copy in the password file, 
\break
then run the {\ltt{}pwd_mkdb} command
\break
to make the password database.
\break
the command must be found on {\ltt{}unix70}
\vf
{\program
newsuelogin -> root@lab30.net.cecs.csulb.edu
  install /home/sue/.login ;
  special "chown sue /home/sue/.login" ;
\endprogram}

copy in the new {\ltt{}.login}
\break
and set sue to own it.

Several commands could be run.

\newslide
You can not {\ltt{}rdist} to a machine unless you have permission.
\break
operates off rlogin/rcp permission ({\ltt{}.rhosts})

{\ltt{}rdist} requires {\ltt{}rshd} to be enabled in
{\ltt{}inetd.conf}
\vt
To install files to {\ltt{}root@unix70}
\break
using the root login on jaguar:

{\ltt{}.rhosts} (for root on unix70)
\break
{\ltt{}jaguar.net.cecs.csulb.edu root}
\vt
To install files to {\ltt{}www@lab30}
\break
using the {\ltt{}css476zz} login on jaguar:

{\ltt{}.rhosts} (for www on lab30)
\break
{\ltt{}jaguar.net.cecs.csulb.edu css476zz}

Client machines must have {\ltt{}rshd} enabled
\break
(uncommented in {\ltt{}inetd.conf})
\vt
Side note:
\break
if your management machine gets compromised,
\break
all machines are compromised
\newslide
\centerline{\bbf Using ssh}

You have two facilities {\ltt{}ssh} and {\ltt{}scp}.

If you don't want to do passwords, set up your passwordless access.

Shell scripts.

{\program
scp newfile.cgi djv@lab99:/home/djv/
ssh djv@lab99 chmod 755 /home/djv/newfile.cgi
\endprogram}

Copy the file over, run a command.
\break
(Note: the default command is a shell.)

Add a loop with a list of machines.
\break
Add a loop with a list of files.

Or:

1) build your distfile
\break
2) locate ssh ({\ltt{}which ssh})
\break
3) tell {\ltt{}rdist} to use {\ltt{}ssh}
\break
{\ltt{}rdist -P /usr/bin/ssh}
\bye
