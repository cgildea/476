\def\chapternumber{Samba -- 3 May 2012}
\input slides.tex
\centerline{\bbf Samba}

Sharing files (and printers) with Windows.

NetBIOS--Network basic I/O System. Protocols for sharing files among
Windows Machines.

SMB--System Message Block: a method of communication between
Windows machines built on top of NetBIOS.
\break
Many levels/revisions of SMB exist.
\break
Can run native on a local net.
\break
Can be encapsulated in TCP/IP packets.

Samba: a software suite that runs SMB protocol on Unix.

Concept: Workgroup--a group of machines cooperating in some way.
\break
Each workgroup or NT domain has a (simple) name.
\break
Example: {\ltt{}CECSNT}

Machines announce their presence with variations of this name:

{\ltt{}CECSNT<00>}-- any server in the work group, any machine supplying
a share (exported file system) or a printer.

{\ltt{}CECSNT<1E>}-- any machine willing to be a master browser

{\ltt{}CECSNT<1C>}-- any machine willing to verify network logons.

{\ltt{}CECSNT<1B>}-- the NT primary domain controller or the master browser
for the domain.

You find out about services/shares/printers by contacting a browser.
\break
Any machine acting as a browser maintains a list.

SMB can be set up for a workgroup (or NT domain).

The six important (Microsoft) versions of the SMB protocol:
PCLAN 1.0 (Core), MS Networks 1.03 (Core Plus), Lanman 1.0,
Lanman 2.0, NTLM 0.12, CIFS 1.0
\break
and several other versions.

\vf
Sample SMB network exchange:

Client: Negotiate protocol (list protocols client can do)
\break
Server: Negotiate protocol response (here's the best)

set up a session: includes username/password
\break
set up response: indicates if username/password was valid.
Server also assigns a session ID.

tree connect: mount/attach a share
\break
connect response: returns a tree identifier.
\newslide
\centerline{\bbf Samba}

A Unix program that provides SMB service.
\break
Using this service, the Unix machine can make ``shares" available or 
access shares from Windows servers.

Samba configuration specifies what file systems to share and
what Windows file options to provide.
\break
Remember: Samba configuration provides Windows options, not Unix options.
\newslide
\centerline{\bbf Samba Servers}

{\ltt{}smbd -D}: handles SMB requests. Concurrent Multiprocess server
(forks a child for each client).

{\ltt{}nmbd -D}: handles NetBIOS name server requests.
\break
Can be a domain master browser, PDC or WINS server.

{\ltt{}smb.conf}: configuration file for both
\break
(found in {\ltt{}/etc/samba}).

\centerline{\bbf Clients}

{\ltt{}nmblookup}: do a NetBIOS lookup

{\ltt{}smbprint}: print on a shared Windows/smb printer

{\ltt{}smbclient}: access a share (using ftp-like command line shell)

{\ltt{}smbtar}: backup a (remote) share to a (local) tape drive
\newslide
\centerline{\bbf smb.conf}

Three special sections, Multiple general sections.

Special section {\ltt{}[globals]}
\break
items that apply to general service or all sections.

{\ltt{}workgroup = HEART}
\break
--- the Windows workgroup/Domain name

{\ltt{}encrypt passwords = yes}
\break
--- no means plain text which NT4.0 needs a
regedit to support

{\ltt{}hosts allow = 134.139.}
\break
--- can restrict access

{\ltt{}security = user}
\break
--- username and password required (or {\ltt{}= share})

{\ltt{}server string = Heart Samba Server}
\break
--- A nice long version of our name.

{\ltt{}local master = yes}
\break
{\ltt{}prefered master = no}
\break
{\ltt{}domain master = no}
\break
{\ltt{}wins support = no}
\break
--- nmbd/NetBIOS options for becoming a Master Browsers and supporting
browsing

{\ltt{}socket options = SO_KEEPALIVE}
\break
--- send ACKs, if the client doesn't respond, shut the connection down.

{\ltt{}domain logons = no}
\break
--- Do we authenticate Windows logons?

Passwords: NT 4.0 ships encrypted passwords. 
The encryption is different from the Unix encryption.
\break
Must maintain a separate list of NT4.0 encryptions ({\ltt{}smbpasswd} file)

Other Windows options include specifications for file locks, oplocks,
maximum file sizes ...
\newslide
Special section {\ltt{}[homes]}
\break
Each user home directory appears as a share.
\break
Usually you set this up to need the user's password.

{\ltt{}browsable = no}
\break
--- the home directories do not appear in the Windows networking panel 

{\ltt{}writeable = yes}
\break
--- the user can write in the home directory
\break
If you are doing a ``public share" this should be ``no"

{\ltt{}valid users = %S}
\break
--- Only the user can access the home directory

Special section {\ltt{}[printers]}
\break
Allows access to any printer specified in {\ltt{}printcap}
\break
If you are making printers available to Windows.
\break
This is for the Windows print protocol only.
\break
A windows machine can be set to use lpr protocol.

A general share section

{\cprogram
[publicstuff]
  path = /usr/public
  read only = yes
  public = yes
@endprogram}

\newslide
\centerline{\bbf Share/Service Verification}

if a Windows client requests a service such as {\ltt{}joe}
Samba:

1) checks for a {\ltt{}[joe]} section.
\break
if this misses and there is a {\ltt{}[homes]} section
\break
2) checks for a user named {\ltt{}joe}
\break
if these miss and there is a {\ltt{}[printers]} section
\break
3) checks for a printer or printer alias named {\ltt{}joe}

So...duplicate identifiers can be a problem

\bye
