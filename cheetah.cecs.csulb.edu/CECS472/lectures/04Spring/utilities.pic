\def\chapternumber{CECS 472, Internet Utilities 1 --- Volper --  8 January 2004}
\input slides.tex
\input cstuff.tex
\centerline{\bbf Network Utilities}

A variety of utilities exist for testing your network and for 
examining its configuration.
\vt
\centerline{\bbf Basic Testing of the network}

Command: {\ltt{}ping}

Action: answer if you are there

{\program
ping aardvark.cecs.csulb.edu
 aardvark.cecs.csulb.edu is alive
\endprogram}

or

{\program
64 bytes from aardvark (134.139.248.26): time=20ms
\endprogram}

Defaults and options differ on different machines.

Some versions/options of ping repeat the test until control-C
\vt
Ping uses ICMP echo and will work even if most of the OS has crashed

Technique: Ping something on the local cables, then try on other cables.
\newslide
\centerline{\bbf Examining ARP Table}

Command: {\ltt{}arp -a}

Action: display the internet-to-ethernet table.

{\program
aardvark> arp -a
? (134.139.248.25) at 00:00:1D:BA:21:9F
grizzly (134.139.248.27) at 00:00:0F:00:8A:04
\endprogram}

These are the current ARP entries.
\break
Since entries time out you may wish to do a
\break
{\ltt{}ping 255.255.255.255}
\break
to activate more enties.
\break
(ping using the broadcast address for the cable) 

If a machine has a name, that name is listed.

Sometimes routers aren't given internet names.
\newslide
\centerline{\bbf Examining Routing Tables}

Command: {\ltt{}netstat}
\break
Action:
examine information about network interfaces
\break
Examine routing table (partial):

{\program
cheetah> netstat -r -n
Destination    Gateway       Genmask     Flags Iface
134.139.248.0  0.0.0.0       255.255.255.252 U  eth0
134.139.248.16 0.0.0.0       255.255.255.248 U  eth1
134.139.248.16 134.139.45.6  255.255.255.224 UG eth1
134.139.248.32 134.139.45.6  255.255.255.224 UG eth1
127.0.0.0      0.0.0.0       255.0.0.0       U  lo
0.0.0.0        134.139.248.1 0.0.0.0         UG eth1
\endprogram}

{\bit Interfaces}: (tells you name, ip number and cable)
\break
{\ltt{}lo}: is {\ltt{}localhost}.
\break
{\ltt{}eth0}: an ethernet card on the ``248.0" cable
\break
{\ltt{}eth1}: an ethernet card on the ``248.16" cable
\break
{\bit Flags}:
\break
{\ltt{}U}: is up (an interface if alone)
\break
{\ltt{}H}: is a host
\break
{\ltt{}G}: is a gateway
\break
{\ltt{}D}: is a redirect entry
\break
{\ltt{}UDGH}: a host is known to be through a gateway, we got the
information by an ICMP redirect because we originally sent the packet to the 
wrong gateway; the routing tables are probably wrong.
\newslide
\centerline{\bbf Examining Protocol Statistics}

partial netstat:

{\program
cheetah> netstat -s
ip:
   26414329 total packets received
   16 bad header checksums
   375574 fragments received
   0 fragments dropped (dup or out of space)
   353 fragments dropped after timeout
   9500565 packets forwarded
icmp:
  406 calls to icmp_error
  Input histogram:
    echo reply: 51
    destination unreachable: 1133
    source quench: 2
    routing redirect: 3
    echo: 59
    time exceeded: 10
\endprogram}

full information also includes tcp and udp actions

Hign numbers of errors indicate a problem that should be investigated.

\newslide
\centerline{\bbf Following Routes}

Command: {\ltt{}traceroute}

Action: Display route the packet will take to destination.

From aardvark:
{\program
aardvark.cecs.csulb.edu> traceroute heart
traceroute to heart (134.139.249.3), 30 hops max
1 134.139.248.25 (134.139.248.25) 0.54ms 0.47ms
2 134.139.147.129 (134.139.147.129) 1.053ms 0.727ms
3 134.139.147.162 (134.139.147.162) 1.683ms 1.204ms
4 heart (134.139.249.3) 1.402 ms 0.921ms 0.856 ms
\endprogram}

The route to heart goes through 3 gateways
\break
134.139.248.25, 134.139.147.129, 134.139.147.162

Remember a gateway has several interfaces
\break
and several internet numbers;
\break
Traceroute will usually report the number of the interface on which you entered
the gateway.
\break
This means the route from bert to aardvark should show different numbers
for the gateways.
\newslide
\centerline{\bbf NIS utilities}

There are alot of functions for examining the contents of the
network information system.

{\ltt{}ypwhich} --- who is my NIS server

{\ltt{}ypcat mapname} --- print a map
\break
Example: {\ltt{}ypcat passwd} -- prints the NIS password map
\break
{\ltt{}ypcat -k netgroup} --- include the "key values" (group names)

{\ltt{}domainname} --- to what NIS domain do I belong

{\ltt{}ypmatch key mapname} -- look an entry with the key 
in the specified map.
\break
Example: {\ltt{}ypmatch cse-ada passwd} -- find the cse-ada entry in the
password map

\newslide
\centerline{\bbf Looking Up Names and Numbers}

Given the name of an internet machine
\break
it is necessary to look up its internet number
\break
(especially since delivery is by number)

{\ltt{}gethostbyname}: a procedure call
\break
given an internet name,
\break
looks up the internet number.

{\ltt{}gethostbyaddr}: a procedure call
\break
given an internet number,
\break
looks up the internet name.

{\ltt{}nslookup}:
a program that when given a name, looks up the number;
and when given a number looks up the name.

{\ltt{}nslookup panther.cecs.csulb.edu}
\break
-- reports {\ltt{}134.139.248.21}

Invoking without any arguments places you in
interactive mode.
\newslide
\centerline{\bbf SNMP Utilities}

panther has two user utilites for getting information from snmp servers.

Command: {\ltt{}snmpnetstat}

Action: get netstat type information about a remote machine 

{\program
snmpnetstat -r -n 134.139.248.2
\endprogram}

Sends a request to the snmpd running on the machine 134.139.248.2 (cheetah)

Options ({\ltt{}-r -n}) say: please send back
\break
iso.ord.dod.internet.mgmt.mib.ip.ipRoutingTable

Program gets: cheetah's routing table.

Program then displays table.

Command: {\ltt{}snmp}

Action: examine information about a remote machine.

{\program
snmp status 134.139.248.2
\endprogram}

Reports information about cheetah, its uptime, the status of its interfaces,
and their ethernet numbers.
\newslide
\centerline{\bbf Miscelleanous Utilities}

{\ltt{}dig}, {\ltt{}host} ---  interfaces to name service information.
(Like nslookup)

{\ltt{}tcpdump} --- look at IP packets going up and down your cable.
You can examine any/all packets.

{\ltt{}etherfind} --- Sun version of tcpdump.

{\ltt{}ripquery} --- fetch me a rip packet and display it.

{\ltt{}ntpdc} --- ntpd monitor, can examine what ntpd is doing and
what is is synchronizing with.

{\ltt{}ifconfig} --- Give the status of an interface, including its
internet number and netmask. (Use netstat to get the names of the interfaces)

\bye
