\def\chapternumber{CECS 472, Internet Management 1 --- Volper -- 13 August 2003}
\input slides.tex
\input cstuff.tex
\centerline{\bbf Managing a Network}
\centerline{\bbf Setting Up an IP Interface}

Each interface must have an internet address.

Each interface must be configured to know its internet address 
(and additional information).

Command: {\ltt{}ifconfig}

Action: examine or set the internet configuration for an interface

Configuring an interface: (Usually at boot time)

Example: from an {\ltt{}/etc/rc.local}

{\program
ifconfig eth0 134.139.3.1 netmask 255.255.255.192
ifconfig eth1 134.139.4.2 netmask 255.255.255.192
\endprogram}

(command is actually on a single line)

Sets up the internet address, netmask and broadcast address.

Must be run for each active interface.

Adds the interface to the routing table.
\newslide
\centerline{\bbf Building Routing Tables}

Command: {\ltt{}route}

Action: add/deletes/report entries in the route table.
\break
Adds are usually done at boot time.

Example: cheetah {\ltt{}/etc/rc.local}

{\program
route add default gw 134.139.4.1 netmask 0.0.0.0
route add -net 134.139.136.0 gw 134.139.45.6 
                           netmask 255.255.255.0
\endprogram}

Note: some versions of route will require:

Subnets can be groups (using netmasking).

Routes can be added to an individual host that violate the subnet rule.

Routes may be added or changed by RIP (if routed is running)
of by ICMP (redirect).

Routes can also be added by a program using the Unix {\ltt{}ioctl} call.
\newslide
\centerline{\bbf NIS Management Utilites}

{\ltt{}ypxfr mapname} --- get a map, usually used at boot
\break
{\ltt{}yppush mapname} --- called by {\ltt{}make map} on the master server,
sends a copy of the map to each known slave server
\break
{\ltt{}ypinit (-s masterserver)} --- set up a master or slave server.
When setting up a slave server you must give the name of the master server.
\break
{\ltt{}ypserv} --- server daemon, started at boot on all servers
\break
{\ltt{}ypbind} --- client daemon, started at boot on all clients
\break
{\ltt{}ypwhich} --- what server are we talking to

netgroups --- a name associated with a list of tuples.
\break
cecssubnet (aardvark,-,cecsnet) (lynx,-,cecsnet)
\break
A netgroup can be used instead of a list of names in many lists including
exports.
\break
Example: {\ltt{}/etc/hosts.equiv}
\break
{\ltt{}+@equiva}

NIS information is usually used to supplement information found in a file.
A special command ({\ltt{}+} or {\ltt{}+@} specifies at which point
the information is to be included.
Example: {\ltt{}/etc/group}

{\program
sys:*:2
+:*:
\endprogram}
\newslide
\centerline{\bbf Domain Name Service}

Needed to connect: an internet address
\break
Have: an internet name

Available system calls:
\break
{\ltt{}gethostbyname} -- gets a number from a name
\break
{\ltt{}gethostbynumber} -- gets a name from a number

{\ltt{}nslookup} -- gets a number from a name or name from number 
(utility program)

Methods:
\break
local file
\break
network data base
\break
domain name service
\break
or combinations thereof

Cheetah: (1) try the local file; 
\break
if a miss (2) try the network data base (nis/yp)
\break
if a miss (3) try the Domain Name Service
\vt
Others may do different orders or special lookups.
\newslide
\centerline{\bbf DNS Client}

Find an Address by:

1) Find a live server from list of servers.

2) Get an answer from the server.

\vt
Specifying a list of servers: list the IP numbers of the servers

file {\ltt{} /etc/resolv.conf} -- name resolver

{\program
domainame cecs.csulb.edu
nameserver 134.139.248.2
nameserver 134.139.1.2
nameserver 134.139.4.15
\endprogram}

Effect: use cheetah (248.2)
\break
if cheetah is down use garuda (1.2)
\break
if cheetah and garuda are down use astro (4.15)

Resolver ({\ltt{}resolv.h}): Set of procedure calls, that query name service.

Manual entry: resolver(5) ({\ltt{}man 5 resolver})
\newslide
\centerline{\bbf DNS Server}

Find an Address:

1) call the root name server and ask for the domain server

2) call domain server and ask for the subdomain server

3) repeat (2) as long as necessary

\vt
for speed: cache

a) cache most recently used name/address mappings

b) cache name/addresses of recently used domain servers

c) name server: cache name/address mappings you have recently learned
(non-authoritative)

Name server: any machine running {\ltt{}named} (cheetah, garuda, astro)

Some name servers are also authorities;
\break
they control (specify) name number mappings.
\newslide
\centerline{\bbf Authoritative Name Servers}

Root name server: serves licenses (i.e., no {\ltt{}.edu} server)
\break
{\ltt{}      ns.internic.net  198.41.0.4}
\break
and several backup servers

Authority on all licenses.
\break
{\ltt{}csulb.edu} owns license for {\ltt{}134.139}, contact {\ltt{}134.139.1.2}
for further information.
\vfill
CSULB name server:
\break
{\ltt{}      garuda.csulb.edu  134.139.1.2}

Authority on much of csulb
\break
For information about {\ltt{}4} cable or {\ltt{}cecs}
contact {\ltt{}134.139.4.15}
\vfill
Engineering name server:
\break
{\ltt{}      astro.engr.csulb.edu  134.139.4.15}

Authority on cables in engineering buildings and machines in engineering 
departments.
\newslide
\centerline{\bbf named}

Answers queries from resolver.
\break
Issues queries as necessary to other named's.
\break
Answers queries as necessary for other named's.

Reads configuration (database) out of files.

Can be configured to dynamically update its
database when receiving information from ``trusted" machines.
\bye

{\ltt{}named.conf} ---  lists zones for which this named acts
as primary or secondary server (authority).
You don't need to be an authority to be a name server.

Concept: each zone has one machine that acts as a primary server.
Secondary servers cover when primary is unavailable.
Secondary server frequently gets ``map" from primary.
\newslide
\centerline{named.conf}

{\program
@ IN SOA cheetah.cecs.csulb.edu.
   root.cheetah.cecs.csulb.edu. (
              200012041  ; Serial
              3600       ; Refresh
              300        ; Retry
              3600000    ; Expire
              3600 )     ; Minimum
zone "cecs.csulb.edu" in {
  type master;
  file "named.hosts.cecs";
}
zone "45.139.134.in-addr.arpa" in {
  typse master;
  file "named.rev45";
}
zone "csulb.edu" in {
  type slave;
  master {134.139.4.15};
  file "csulb.bak";
}
\endprogram}

SOA information about this zone and instructions for secondaries.
\break
Primary for cecs and ``45" cable
\break
Secondary for csulb.
\newslide
\centerline{\bbf named}

{\ltt{}root.cache} --- The initial cache for this name server.
Always includes the name of the root servers.

{\program
.  3600000  IN NS A.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET. 3600000 A 198.41.0.4
\endprogram}

{\ltt{}A} is a root DNS server.
\break
From there we can find a server for any domain.

A time-out value ({\ltt{}86400}) is given,
\break
for root servers a huge value suffices.

\newslide
\centerline{\bbf named}

{\ltt{}named.hosts} --- names/addresses of hosts, delegation of authority.

The name varies and is the one given by the {\ltt{}primary} entry
in {\ltt{}named.boot} (e.g., {\ltt{}named.hosts.cecs})

{\program
lynx    IN   A   134.139.45.15
        IN   NS  astro.engr.csulb.edu.
\endprogram}

{\ltt{}lynx.cecs.csulb.edu} has internet address {\ltt 134.139.45.15}

{\ltt{}astro} is a name server for {\ltt{}cecs.csulb.edu}
(delegation)
\vt
{\ltt{}named.rev} --- addresses/names of hosts, deletation of authority.

The name varies and is the one given by the {\ltt{}primary} entry
in {\ltt{}named.boot} (e.g., {\ltt{}named.rev45})

{\program
15  IN  PTR  lynx.cecs.csulb.edu.
\endprogram}

{\ltt{}15.45.139.134.in-addr.arpa} is the internet number of {\ltt{}lynx}

Numbers are given in reverse order.
\newslide
\centerline{\bbf Network Time Protocol}

{\ltt{}ntp} --- examine/adjust clock. 

User can examine/root can set

{\ltt{}ntp -s -f server.edu} --
\break
changes the clock to match the server's time.

Caution: all of a sudden the time changes.

Done at boot, before starting daemon ({\ltt{}/etc/rc}).

\vt
{\ltt{}ntpd} --- the daemon that adjusts the clock.

Started at boot.

Reads {\ltt{}/etc/ntpd.conf} for servers.
\break
The format of this file varies.

Gradually adjusts the clock to match servers

server: closer to the master clock than you
\break
peer: same distance from master clock as you

Client mode: gets the time from another ntpd.
\break
Server mode: gives the time to other ntpds.

New version: {\ltt{}xntpd}

\newslide
\centerline{\bbf Sendmail}
\vt
Requirement: A powerful parser to analyze destination addresses. 

Basic choices:

1) internet site: send direct (tcp/ip)

2) dial up: save in spool until a phone call is made

3) other net: send to a gateway

4) local: save in file until read by the user 

Other issue: site/gateway down = queue and send later
\vt
{\ltt{}/usr/lib/sendmail -bd -q1h}

run as a daemon, try to send the queue once each hour.

Aliases: a list is maintained.
\break
For any mail that appears local, an alias(es) can be given.

{\ltt{}/etc/aliases}:
\break
{\ltt{}cecs472instructor: volper@csulb.edu}
\newslide
\centerline{\bbf sendmail.cf}

A regular expression with replacement

{\ltt{}$} special meaning for following character

{\ltt{}R$-@$+ $#tcpmail$@$2$:$1<@$2>}

R = rule
\break
rewrites {\ltt{}$1}=first match {\ltt{}$2}=second match
\break
match one token,
\break
followed by an {\ltt{}@}
\break
followed by one or more tokens
\break
Action: send using tcp

matches {\ltt{}volper@ics.uci.edu}

Sends to host {\ltt{}$2} = {\ltt{}ics.uci.edu}
\break
send to user {\ltt{}$1} = {\ltt{}volper<@ics.uci.edu>}

Example 2:

{\ltt{}R$+<@$+.bitnet>     $1%$2<@cunyvm.cuny.edu>}

{\ltt{}mahoney<@csulb.bitnet>} (from previous parse)
\break
{\ltt{}$1=mahoney}, {\ltt{}$2=csulb}
\break
{\ltt{}mahoney%csulb<@cunyvm.cuny.edu>}
\newslide
